(this.webpackJsonpbproject=this.webpackJsonpbproject||[]).push([[5],{79:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),r=n(36),o=n(5),i=n(78),c=n(24),s=n(16),m=n(1),u=n.n(m),d=n(9),f=n(3),E=n(6),b=n(8),v=n(37);function useListItem(e,t){var n,a=useListItems(t);return null!==(n=null===a||void 0===a?void 0:a.find((function(t){return t.bookId===e})))&&void 0!==n?n:null}function useListItems(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(s.c)(),n=Object(b.d)(Object(E.a)(Object(E.a)({queryKey:"list-items",queryFn:function queryFn(){return t("list-items").then((function(e){return e.listItems}))}},e),{},{config:Object(E.a)(Object(E.a)({},e.config),{},{onSuccess:function(){var t=Object(f.a)(u.a.mark((function _callee(t){var n,a,l,r,o;return u.a.wrap((function _callee$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,null===(n=e.config)||void 0===n||null===(a=n.onSuccess)||void 0===a?void 0:a.call(n,t);case 2:l=Object(d.a)(t);try{for(l.s();!(r=l.n()).done;)o=r.value,Object(v.a)(o.book)}catch(c){l.e(c)}finally{l.f()}case 4:case"end":return i.stop()}}),_callee)})));return function onSuccess(e){return t.apply(this,arguments)}}()})})),a=n.data;return null!==a&&void 0!==a?a:[]}var h={onError:function onError(e,t,n){return"function"===typeof n?n():null},onSettled:function onSettled(){return b.b.invalidateQueries("list-items")}};function onUpdateMutation(e){var t=b.b.getQueryData("list-items");return b.b.setQueryData("list-items",(function(t){return t.map((function(t){return t.id===e.id?Object(E.a)(Object(E.a)({},t),e):t}))})),function(){return b.b.setQueryData("list-items",t)}}function useUpdateListItem(e){var t=Object(s.c)();return Object(b.c)((function(e){return t("list-items/".concat(e.id),{method:"PUT",data:e})}),Object(E.a)(Object(E.a)({onMutate:onUpdateMutation},h),e))}var g=n(7),k=n(19),p=n(67),y=n(38),N=["label","highlight","onClick","icon"];function TooltipButton(e){var t=e.label,n=(e.highlight,e.onClick),l=e.icon,r=Object(k.a)(e,N),o=Object(y.a)(),i=o.isLoading,s=o.isError,m=o.error,u=o.run,d=o.reset;return a.createElement("div",{label:s?m.message:t},a.createElement(c.c,Object.assign({className:"bg-white hover:text-gray focus:text-gray",disabled:i,onClick:function handleClick(){s?d():u(n())},"aria-label":s?m.message:t},r),i?a.createElement(c.k,null):s?a.createElement(p.i,null):l))}function StatusButtons(e){var t=e.book,n=useListItem(t.id),l=useUpdateListItem({throwOnError:!0}),r=Object(g.a)(l,1)[0],o=function useRemoveListItem(e){var t=Object(s.c)();return Object(b.c)((function(e){var n=e.id;return t("list-items/".concat(n),{method:"DELETE"})}),Object(E.a)(Object(E.a)({onMutate:function onMutate(e){var t=b.b.getQueryData("list-items");return b.b.setQueryData("list-items",(function(t){return t.filter((function(t){return t.id!==e.id}))})),function(){return b.b.setQueryData("list-items",t)}}},h),e))}({throwOnError:!0}),i=Object(g.a)(o,1)[0],c=function useCreateListItem(e){var t=Object(s.c)();return Object(b.c)((function(e){var n=e.bookId;return t("list-items",{data:{bookId:n}})}),Object(E.a)(Object(E.a)({},h),e))}({throwOnError:!0}),m=Object(g.a)(c,1)[0];return a.createElement(a.Fragment,null,n?Boolean(n.finishDate)?a.createElement(TooltipButton,{label:"Mark as unread",className:"text-yellow",onClick:function onClick(){return r({id:n.id,finishDate:null})},icon:a.createElement(p.a,null)}):a.createElement(TooltipButton,{label:"Mark as read",className:"text-green",onClick:function onClick(){return r({id:n.id,finishDate:Date.now()})},icon:a.createElement(p.b,null)}):null,n?a.createElement(TooltipButton,{label:"Remove from list",className:"text-red",onClick:function onClick(){return i({id:n.id})},icon:a.createElement(p.c,null)}):a.createElement(TooltipButton,{label:"Add to list",className:"text-indigo",onClick:function onClick(){return m({bookId:t.id})},icon:a.createElement(p.d,null)}))}var j="b-0 h-1 -m-1 overflow-hidden p-0 bg-clip-content absolute w-1";function Rating(e){var t=e.listItem,n=a.useState(!1),l=Object(g.a)(n,2),r=(l[0],l[1]),o=useUpdateListItem(),i=Object(g.a)(o,2),s=i[0],m=i[1],u=m.error,d=m.isError;a.useEffect((function(){function handleKeyDown(e){"Tab"===e.key&&r(!0)}return document.addEventListener("keydown",handleKeyDown,{once:!0}),function(){return document.removeEventListener("keydown",handleKeyDown)}}),[]);var f="list-item-".concat(t.id),E=Array.from({length:5}).map((function(e,n){var l="rating-".concat(t.id,"-").concat(n),r=n+1;return a.createElement(a.Fragment,{key:n},a.createElement("input",{name:f,type:"radio",id:l,value:r,checked:r===t.rating,onChange:function onChange(){s({id:t.id,rating:r})},className:j}),a.createElement("label",{htmlFor:l,className:"cursor-pointer text-gray-500 m-0"},a.createElement("span",{className:j},r," ",1===r?"star":"stars"),a.createElement(p.g,{className:"w-4 mt-0 mr-2"})))}));return a.createElement("div",{onClick:function onClick(e){return e.stopPropagation()},className:f},a.createElement("span",{className:"flex"},E),d?a.createElement(c.e,{error:u,className:"inline ml-6 font-0.5"}):null)}function BookRow(e){var t=e.book,n=t.title,a=t.author,o=t.coverImageUrl,i=useListItem(t.id),c="book-row-book-".concat(t.id);return l.a.createElement("div",{className:"flex items-center relative content-end"},l.a.createElement(r.b,{"aria-labelledby":c,to:"/book/".concat(t.id),className:"min-h-270 flex-grow grid auto-cols-max gap-2 border-solid border-gray-200 text-black p-1.5 rounder-3 focus:hover:no-underline "},l.a.createElement("div",{className:"w-140 md:w-100"},l.a.createElement("img",{src:o,alt:"".concat(n," book cover"),className:"max-h-full w-full"})),l.a.createElement("div",{className:"flex-1"},l.a.createElement("div",{className:"flex justify-between"},l.a.createElement("div",{className:"flex-1"},l.a.createElement("h2",{id:c,className:"text-lg m-0 text-indigo-300"},n),(null===i||void 0===i?void 0:i.finishDate)?l.a.createElement(Rating,{listItem:i}):null),l.a.createElement("div",{className:"ml-2.5"},l.a.createElement("div",{className:"mt-0.2 italic text-sm"},a),l.a.createElement("small",null,t.publisher))),l.a.createElement("small",{className:"whitespace-pre-wrap block"},t.synopsis.substring(0,500),"..."))),l.a.createElement("div",{className:"ml-8 absolute -right-20 text-gray-500 flex flex-col justify-around h-full"},l.a.createElement(StatusButtons,{book:t})))}function ListItemList(e){var t=e.filterListItems,n=e.noListItems,a=e.noFilteredListItems,r=useListItems(),o=r.filter(t);return r.length?o.length?l.a.createElement(c.a,null,o.map((function(e){return l.a.createElement("li",{key:e.id,"aria-label":e.book.title},l.a.createElement(BookRow,{book:e.book}))}))):l.a.createElement("div",{className:"mt-1 font-1.2"},a):l.a.createElement("div",{className:"mt-1 font-1.2"},n)}function ReadingListScreen(){return a.createElement(ListItemList,{filterListItems:function filterListItems(e){return!e.finishDate},noListItems:a.createElement("p",null,"Hey there! Welcome to your bookshelf reading list. Get started by heading over to ",a.createElement(c.j,{to:"/discover"},"the Discover page")," to add books to your list."),noFilteredListItems:a.createElement("p",null,"Looks like you've finished all your books! Check them out in your"," ",a.createElement(c.j,{to:"/finished"},"finished books")," or"," ",a.createElement(c.j,{to:"/discover"},"discover more"),".")})}function FinishedScreen(){return a.createElement(ListItemList,{filterListItems:function filterListItems(e){return Boolean(e.finishDate)},noListItems:a.createElement("p",null,"Hey there! This is where books will go when you've finished reading them. Get started by heading over to"," ",a.createElement(c.j,{to:"/discover"},"the Discover page")," to add books to your list."),noFilteredListItems:a.createElement("p",null,"Looks like you've got some reading to do! Check them out in your"," ",a.createElement(c.j,{to:"/list"},"reading list")," or"," ",a.createElement(c.j,{to:"/discover"},"discover more"),".")})}var w=n(71);function DiscoverBooksScreen(){var e=a.useState(""),t=Object(g.a)(e,2),n=t[0],l=t[1],r=a.useState(),o=Object(g.a)(r,2),i=o[0],s=o[1],m=Object(v.c)(n),u=m.books,d=m.error,f=m.isLoading,E=m.isError,b=m.isSuccess,h=Object(v.d)();return a.useEffect((function(){return function(){return h()}}),[h]),a.createElement("div",null,a.createElement("div",null,a.createElement("form",{onSubmit:function handleSearchClick(e){e.preventDefault(),s(!0),l(e.target.elements.search.value)}},a.createElement(c.i,{placeholder:"Search books...",id:"search",type:"search",className:"w-full"}),a.createElement(w.a,{label:"Search Books"},a.createElement("label",{htmlFor:"search"},a.createElement("button",{type:"submit",className:"b-0 relative -ml-35 bg-transparent"},f?a.createElement(c.k,null):E?a.createElement(p.h,{"aria-label":"error",className:"text-red"}):a.createElement(p.f,{"aria-label":"search"}))))),E?a.createElement("div",{className:"text-red"},a.createElement("p",null,"There was an error:"),a.createElement("pre",null,d.message)):null),a.createElement("div",null,i?null:a.createElement("div",{className:"mt-20 text-base text-center"},a.createElement("p",null,"Welcome to the discover page."),a.createElement("p",null,"Here, let me load a few books for you..."),f?a.createElement("div",{className:"w-full m-auto"},a.createElement(c.k,null)):b&&u.length?a.createElement("p",null,"Here you go! Find more books with the search bar above."):b&&!u.length?a.createElement("p",null,"Hmmm... I couldn't find any books to suggest for you. Sorry."):null),u.length?a.createElement(c.a,{className:"mt-20"},u.map((function(e){return a.createElement("li",{key:e.id,"aria-label":e.title},a.createElement(BookRow,{key:e.id,book:e}))}))):i?a.createElement("div",{className:"mt-20 text-lg text-center"},f?a.createElement("div",{className:"w-full m-auto"},a.createElement(c.k,null)):a.createElement("p",null,"Hmmm... I couldn't find any books with the query \"",n,'." Please try another.')):null))}var x=n(73),I=n.n(x),L=function formatDate(e){return new Intl.DateTimeFormat("en-US",{month:"short",year:"2-digit"}).format(e)};function BookScreen(){var e=Object(o.h)().bookId,t=Object(v.b)(e),n=useListItem(e),l=t.title,r=t.author,i=t.coverImageUrl,c=t.publisher,s=t.synopsis;return a.createElement("div",null,a.createElement("div",{className:"grid mb-1 grid-cols-book gap-x-1.5 md:flex md:flex-col"},a.createElement("img",{src:i,alt:"".concat(l," book cover"),className:"w-full max-w-xs"}),a.createElement("div",null,a.createElement("div",{className:"flex relative"},a.createElement("div",{className:"flex-1 justify-between"},a.createElement("h1",null,l),a.createElement("div",null,a.createElement("i",null,r),a.createElement("span",{className:"mr-6 ml-6"},"|"),a.createElement("i",null,c))),a.createElement("div",{className:"r-0 text-gray flex flex-col justify-around min-q-full"},t.loadingBook?null:a.createElement(StatusButtons,{book:t}))),a.createElement("div",{className:"mt-10 min-h-min"},(null===n||void 0===n?void 0:n.finishDate)?a.createElement(Rating,{listItem:n}):null,n?a.createElement(ListItemTimeframe,{listItem:n}):null),a.createElement("br",null),a.createElement("p",{className:"block whitespace-pre-wrap"},s))),!t.loadingBook&&n?a.createElement(NotesTextarea,{listItem:n}):null)}function ListItemTimeframe(e){var t=e.listItem,n=t.finishDate?"Start and finish date":"Start date";return a.createElement(w.a,{label:n},a.createElement("div",{"aria-label":n,className:"mt-5"},a.createElement(p.e,{className:"-mt-2 mr-5"}),a.createElement("span",null,L(t.startDate)," ",t.finishDate?"\u2014 ".concat(L(t.finishDate)):null)))}function NotesTextarea(e){var t=e.listItem,n=useUpdateListItem(),l=Object(g.a)(n,2),r=l[0],o=l[1],i=o.error,s=o.isError,m=o.isLoading,u=a.useMemo((function(){return I()(r,{wait:500})}),[r]);return a.createElement(a.Fragment,null,a.createElement("div",null,a.createElement("label",{htmlFor:"notes",className:"inline-block mr-10 mt-0 mb-0.5 font-bold"},"Notes"),s?a.createElement(c.e,{variant:"inline",error:i,className:"font-0.5"}):null,m?a.createElement(c.k,null):null),a.createElement(c.l,{id:"notes",defaultValue:t.notes,onChange:function handleNotesChange(e){u({id:t.id,notes:e.target.value})},className:"w-full min-h-300"}))}function NotFoundScreen(){return l.a.createElement("div",{classNanw:"h-full grid items-center justify-center"},l.a.createElement("div",null,"Sorry... nothing here. ",l.a.createElement(c.j,{to:"/list"},"Go home")))}function ErrorFallback(e){var t=e.error;return l.a.createElement(c.e,{error:t,className:"h-full flex flex-col content-center items-center"})}function NavLink(e){return l.a.createElement(r.b,Object.assign({className:"block p-2 mt-1 w-full h-full text-black rounder-1 border-r-2 border-solid border-transparent hover:text-gray hover:text-none hover:bg-indigo-500"},e))}function Nav(e){return l.a.createElement("nav",{className:"sticky inset-t-4 pt-1 pr-1.5 border border-solid border-gray-50 md:static md:inset-t"},l.a.createElement("ul",{className:"list-none p-0"},l.a.createElement("li",null,l.a.createElement(NavLink,{to:"/list"},"Reading List")),l.a.createElement("li",null,l.a.createElement(NavLink,{to:"/finished"},"Finished Books")),l.a.createElement("li",null,l.a.createElement(NavLink,{to:"/discover"},"Discover"))))}function AppRoutes(){return l.a.createElement(o.c,null,l.a.createElement(o.a,{path:"/list",element:l.a.createElement(ReadingListScreen,null)}),l.a.createElement(o.a,{path:"/finished",element:l.a.createElement(FinishedScreen,null)}),l.a.createElement(o.a,{path:"/discover",element:l.a.createElement(DiscoverBooksScreen,null)}),l.a.createElement(o.a,{path:"/book/:bookId",element:l.a.createElement(BookScreen,null)}),l.a.createElement(o.a,{path:"*",element:l.a.createElement(NotFoundScreen,null)}))}t.default=function AuthenticatedApp(){var e=Object(s.b)(),t=e.user,n=e.logout;return l.a.createElement(i.ErrorBoundary,{FallbackComponent:c.g},l.a.createElement("div",{className:"flex items-center absolute inset-t-4 inset-r-4"},t.username,l.a.createElement(c.b,{variant:"secondary",className:"ml-2.5",onClick:n},"Logout")),l.a.createElement("div",{className:"m-0 pt-2 pt-1 max-w-10 w-full grid gap-1 grid-cols-3 md:grid-cols-1 md:w-full md:grid-rows-6 ..."},l.a.createElement("div",{className:"relative"},l.a.createElement(Nav,null)),l.a.createElement("main",{className:"w-full"},l.a.createElement(i.ErrorBoundary,{FallbackComponent:ErrorFallback},l.a.createElement(AppRoutes,null)))))}}}]);
//# sourceMappingURL=5.2ce108ee.chunk.js.map